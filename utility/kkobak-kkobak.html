<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¼¬ë°•ê¼¬ë°• - ì˜ì–‘ì œ & ë¬¼ ìŠµê´€ ê´€ë¦¬</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        body {
            font-family: 'Pretendard', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(2px);
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        
        /* ìˆ¨ê²¨ì§„ DatePicker (í…ìŠ¤íŠ¸ ìœ„ì— ì˜¤ë²„ë ˆì´ìš©) */
        input[type="date"]::-webkit-calendar-picker-indicator {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 antialiased">

    <!-- Main App Container -->
    <div class="max-w-md mx-auto bg-white min-h-screen shadow-lg relative pb-20">
        
        <!-- Header with Calendar Navigation -->
        <header class="pt-8 pb-4 px-6 bg-white sticky top-0 z-40 border-b border-slate-100 flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold text-slate-800 mb-1">ê¼¬ë°•ê¼¬ë°•</h1>
                
                <!-- Date Navigation -->
                <div class="flex items-center gap-2">
                    <button onclick="changeDate(-1)" class="p-1 -ml-1 text-slate-400 hover:text-slate-700 transition rounded-full hover:bg-slate-50 active:scale-95">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    </button>
                    
                    <div class="relative flex items-center gap-1 cursor-pointer group px-2 py-1 rounded-lg hover:bg-blue-50 transition">
                        <svg class="w-4 h-4 text-slate-400 group-hover:text-blue-500 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                        <span id="currentDateDisplay" class="text-sm font-bold text-slate-600 group-hover:text-blue-600 transition">ë‚ ì§œ ë¡œë”©ì¤‘...</span>
                        <input type="date" id="datePicker" class="absolute inset-0 opacity-0 cursor-pointer w-full h-full" onchange="handleDateSelect(event)">
                    </div>

                    <button onclick="changeDate(1)" class="p-1 text-slate-400 hover:text-slate-700 transition rounded-full hover:bg-slate-50 active:scale-95">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </button>
                </div>
            </div>
        </header>

        <main class="p-6 space-y-6">
            
            <!-- Water Tracker Section -->
            <section class="bg-blue-50 rounded-3xl p-6 border border-blue-100 relative overflow-hidden">
                <div class="flex justify-between items-center mb-4 relative z-10">
                    <h2 class="text-lg font-bold text-blue-900 flex items-center gap-2">
                        <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12.5V10c0-4.418-4.03-8-9-8s-9 3.582-9 8v2.5c0 4.418 4.03 8 9 8s9-3.582 9-8z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 22v-3"></path></svg>
                        ìˆ˜ë¶„ ì„­ì·¨ëŸ‰
                    </h2>
                    <button id="btnEditWaterGoal" onclick="openWaterGoalModal()" class="text-xs text-blue-600 bg-blue-100 px-3 py-1.5 rounded-full font-medium hover:bg-blue-200 transition">
                        ëª©í‘œ ìˆ˜ì •
                    </button>
                </div>

                <div class="flex justify-between items-end mb-3 relative z-10">
                    <div class="flex items-end gap-2">
                        <span class="text-4xl font-extrabold text-blue-600" id="waterCurrentDisplay">0</span>
                        <span class="text-slate-500 font-medium mb-1">/ <span id="waterGoalDisplay">2000</span> ml</span>
                    </div>
                    <!-- ëª©í‘œ ë‹¬ì„± ì¶•í•˜ ë©”ì‹œì§€ (ê¸°ë³¸ ìˆ¨ê¹€) -->
                    <div id="waterSuccessMsg" class="hidden text-sm font-bold text-teal-600 bg-teal-50 px-3 py-1.5 rounded-full mb-1 animate-pulse flex items-center gap-1 border border-teal-100 shadow-sm">
                        <span>ğŸ‰</span> ëª©í‘œ ë‹¬ì„±!
                    </div>
                </div>

                <!-- Progress Bar -->
                <div class="h-3 w-full bg-blue-100 rounded-full overflow-hidden mb-5 relative z-10">
                    <div id="waterProgressBar" class="h-full bg-blue-500 transition-all duration-500 ease-out" style="width: 0%;"></div>
                </div>

                <!-- Quick Add Buttons -->
                <div id="waterActionButtons" class="grid grid-cols-3 gap-2 relative z-10">
                    <button onclick="addWater(100)" class="py-2 bg-white rounded-xl text-sm font-medium text-blue-700 shadow-sm border border-blue-100 hover:bg-blue-50 active:scale-95 transition">+100ml</button>
                    <button onclick="addWater(250)" class="py-2 bg-white rounded-xl text-sm font-medium text-blue-700 shadow-sm border border-blue-100 hover:bg-blue-50 active:scale-95 transition">+250ml</button>
                    <button onclick="openWaterCustomModal()" class="py-2 bg-white rounded-xl text-sm font-medium text-blue-700 shadow-sm border border-blue-100 hover:bg-blue-50 active:scale-95 transition">ì§ì ‘ì…ë ¥</button>
                </div>
            </section>

            <!-- Supplements Section -->
            <section>
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-bold text-slate-800">ì˜ì–‘ì œ & ì•½ ë³µìš©</h2>
                    <button id="btnAddSupplement" onclick="openSupplementModal('add')" class="text-sm text-white bg-slate-800 px-4 py-2 rounded-xl font-medium hover:bg-slate-700 active:scale-95 transition flex items-center gap-1">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                        ì¶”ê°€
                    </button>
                </div>

                <!-- Timeline / Categories -->
                <div id="supplementsTimeline" class="space-y-4">
                    <!-- Morning -->
                    <div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
                        <div class="bg-orange-50 px-4 py-3 border-b border-orange-100 flex items-center gap-2">
                            <span class="text-orange-500 text-lg">ğŸŒ…</span>
                            <h3 class="font-bold text-orange-900">ì•„ì¹¨</h3>
                        </div>
                        <ul id="list-morning" class="divide-y divide-slate-100 px-2">
                            <!-- Items injected here -->
                        </ul>
                    </div>

                    <!-- Lunch -->
                    <div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
                        <div class="bg-yellow-50 px-4 py-3 border-b border-yellow-100 flex items-center gap-2">
                            <span class="text-yellow-500 text-lg">â˜€ï¸</span>
                            <h3 class="font-bold text-yellow-900">ì ì‹¬</h3>
                        </div>
                        <ul id="list-lunch" class="divide-y divide-slate-100 px-2">
                             <!-- Items injected here -->
                        </ul>
                    </div>

                    <!-- Dinner -->
                    <div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
                        <div class="bg-indigo-50 px-4 py-3 border-b border-indigo-100 flex items-center gap-2">
                            <span class="text-indigo-500 text-lg">ğŸŒ™</span>
                            <h3 class="font-bold text-indigo-900">ì €ë…</h3>
                        </div>
                        <ul id="list-dinner" class="divide-y divide-slate-100 px-2">
                             <!-- Items injected here -->
                        </ul>
                    </div>
                </div>

                <!-- Empty State Guide -->
                <div id="supplementsEmptyState" class="hidden bg-slate-50 border-2 border-dashed border-slate-200 rounded-2xl p-8 text-center mt-2">
                    <div class="text-4xl mb-3">ğŸ’Š</div>
                    <h3 class="text-lg font-bold text-slate-800 mb-2">ì²« ì˜ì–‘ì œë¥¼ ë“±ë¡í•´ë³´ì„¸ìš”!</h3>
                    <p class="text-sm text-slate-500 mb-6">ë§¤ì¼ ì±™ê²¨ ë¨¹ëŠ” ì˜ì–‘ì œë‚˜ ì•½ì„ ë“±ë¡í•˜ë©´<br>ì‹œê°„ëŒ€ë³„ë¡œ ìŠì§€ ì•Šê³  ê´€ë¦¬í•  ìˆ˜ ìˆì–´ìš”.</p>
                    <button id="btnEmptyAddSupplement" onclick="openSupplementModal('add')" class="inline-flex items-center justify-center gap-2 bg-slate-800 text-white px-6 py-3 rounded-xl font-medium hover:bg-slate-700 transition active:scale-95">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                        ì˜ì–‘ì œ ì¶”ê°€í•˜ê¸°
                    </button>
                </div>
            </section>
        </main>
    </div>

    <!-- Modals (Hidden by default) -->
    <!-- Supplement Modal (Add/Edit) -->
    <div id="supplementModal" class="fixed inset-0 z-50 flex items-center justify-center modal-overlay hidden opacity-0 transition-opacity duration-300">
        <div class="bg-white rounded-3xl p-6 w-11/12 max-w-sm shadow-2xl transform scale-95 transition-transform duration-300">
            <h3 id="suppModalTitle" class="text-xl font-bold text-slate-800 mb-5">ì˜ì–‘ì œ ë“±ë¡</h3>
            <input type="hidden" id="suppId">
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-600 mb-1">ë³µìš© ì‹œê°„ëŒ€</label>
                    <div class="grid grid-cols-3 gap-2">
                        <label class="cursor-pointer">
                            <input type="radio" name="suppTime" value="morning" class="peer sr-only" checked>
                            <div class="text-center py-2 px-3 rounded-xl border border-slate-200 peer-checked:bg-orange-100 peer-checked:border-orange-400 peer-checked:text-orange-700 transition">ì•„ì¹¨</div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" name="suppTime" value="lunch" class="peer sr-only">
                            <div class="text-center py-2 px-3 rounded-xl border border-slate-200 peer-checked:bg-yellow-100 peer-checked:border-yellow-400 peer-checked:text-yellow-700 transition">ì ì‹¬</div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" name="suppTime" value="dinner" class="peer sr-only">
                            <div class="text-center py-2 px-3 rounded-xl border border-slate-200 peer-checked:bg-indigo-100 peer-checked:border-indigo-400 peer-checked:text-indigo-700 transition">ì €ë…</div>
                        </label>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-slate-600 mb-1">ì˜ì–‘ì œ ì´ë¦„</label>
                    <input type="text" id="suppName" placeholder="ì˜ˆ: ë¹„íƒ€ë¯¼ C" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                </div>

                <div>
                    <label class="block text-sm font-medium text-slate-600 mb-1">1íšŒ ë³µìš©ëŸ‰</label>
                    <input type="text" id="suppDosage" placeholder="ì˜ˆ: 1ì•Œ, 200mg" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                </div>
            </div>

            <div class="flex gap-3 mt-8">
                <button onclick="closeModal('supplementModal')" class="flex-1 py-3 bg-slate-100 text-slate-600 font-medium rounded-xl hover:bg-slate-200 transition">ì·¨ì†Œ</button>
                <button onclick="saveSupplement()" class="flex-1 py-3 bg-slate-800 text-white font-medium rounded-xl hover:bg-slate-700 transition">ì €ì¥í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <!-- Water Goal Modal -->
    <div id="waterGoalModal" class="fixed inset-0 z-50 flex items-center justify-center modal-overlay hidden opacity-0 transition-opacity duration-300">
        <div class="bg-white rounded-3xl p-6 w-11/12 max-w-sm shadow-2xl transform scale-95 transition-transform duration-300">
            <h3 class="text-xl font-bold text-slate-800 mb-2">ëª©í‘œ ìˆ˜ë¶„ ì„­ì·¨ëŸ‰</h3>
            <p class="text-sm text-slate-500 mb-5">í•˜ë£¨ì— ë§ˆì‹¤ ëª©í‘œëŸ‰(ml)ì„ ì„¤ì •í•˜ì„¸ìš”.</p>
            
            <div class="relative">
                <input type="number" id="waterGoalInput" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg font-bold text-center pr-12">
                <span class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 font-medium">ml</span>
            </div>

            <div class="flex gap-3 mt-8">
                <button onclick="closeModal('waterGoalModal')" class="flex-1 py-3 bg-slate-100 text-slate-600 font-medium rounded-xl hover:bg-slate-200 transition">ì·¨ì†Œ</button>
                <button onclick="saveWaterGoal()" class="flex-1 py-3 bg-blue-600 text-white font-medium rounded-xl hover:bg-blue-700 transition">ì„¤ì •í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <!-- Custom Water Add Modal -->
    <div id="waterCustomModal" class="fixed inset-0 z-50 flex items-center justify-center modal-overlay hidden opacity-0 transition-opacity duration-300">
        <div class="bg-white rounded-3xl p-6 w-11/12 max-w-sm shadow-2xl transform scale-95 transition-transform duration-300">
            <h3 class="text-xl font-bold text-slate-800 mb-2">ìˆ˜ë¶„ ì„­ì·¨ ì§ì ‘ ì…ë ¥</h3>
            
            <div class="relative mt-4">
                <input type="number" id="waterCustomInput" placeholder="0" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg font-bold text-center pr-12">
                <span class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 font-medium">ml</span>
            </div>

            <div class="flex gap-3 mt-8">
                <button onclick="closeModal('waterCustomModal')" class="flex-1 py-3 bg-slate-100 text-slate-600 font-medium rounded-xl hover:bg-slate-200 transition">ì·¨ì†Œ</button>
                <button onclick="saveCustomWater()" class="flex-1 py-3 bg-blue-600 text-white font-medium rounded-xl hover:bg-blue-700 transition">ì¶”ê°€í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <!-- Action Confirmation Modal -->
    <div id="confirmModal" class="fixed inset-0 z-50 flex items-center justify-center modal-overlay hidden opacity-0 transition-opacity duration-300">
        <div class="bg-white rounded-3xl p-6 w-11/12 max-w-sm shadow-2xl transform scale-95 transition-transform duration-300 text-center">
            <div class="w-16 h-16 bg-red-100 text-red-500 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            </div>
            <h3 class="text-xl font-bold text-slate-800 mb-2">ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h3>
            <p class="text-sm text-slate-500 mb-6">ì‚­ì œëœ ê¸°ë¡ì€ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
            
            <div class="flex gap-3">
                <button onclick="closeModal('confirmModal')" class="flex-1 py-3 bg-slate-100 text-slate-600 font-medium rounded-xl hover:bg-slate-200 transition">ì·¨ì†Œ</button>
                <button id="confirmBtn" class="flex-1 py-3 bg-red-500 text-white font-medium rounded-xl hover:bg-red-600 transition">ì‚­ì œ</button>
            </div>
        </div>
    </div>

    <script>
        // --- Data & State Management (localStorage ì ìš©) ---
        
        // ë¡œì»¬ íƒ€ì„ì¡´ ê¸°ì¤€ YYYY-MM-DD í¬ë§· ë°˜í™˜ í•¨ìˆ˜
        function getLocalYYYYMMDD(dateObj) {
            const offset = dateObj.getTimezoneOffset() * 60000;
            return (new Date(dateObj - offset)).toISOString().slice(0, 10);
        }

        const todayStr = getLocalYYYYMMDD(new Date());
        let selectedDate = todayStr;
        
        // localStorageì—ì„œ ì „ì²´ ë°ì´í„° ë¡œë“œ
        let appData = JSON.parse(localStorage.getItem('kkobakData')) || {};

        // í˜„ì¬ ì„ íƒëœ ë‚ ì§œì˜ ìƒíƒœ (í™”ë©´ì— ê·¸ë ¤ì§€ëŠ” ë°ì´í„°)
        let state = {
            water: { goal: 2000, current: 0 },
            supplements: []
        };

        // --- Initialization ---
        function init() {
            loadDataForDate(selectedDate);
        }

        // --- Date & Calendar Logic ---
        
        function loadDataForDate(dateStr) {
            if (appData[dateStr]) {
                // í•´ë‹¹ ë‚ ì§œì— ë°ì´í„°ê°€ ìˆìœ¼ë©´ ë³µì‚¬í•´ì„œ ì‚¬ìš©
                state = JSON.parse(JSON.stringify(appData[dateStr]));
            } else {
                // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê³¼ê±° ê°€ì¥ ìµœê·¼ ê¸°ë¡ì„ ì°¾ì•„ ì˜ì–‘ì œ ë¦¬ìŠ¤íŠ¸ì™€ ë¬¼ ëª©í‘œëŸ‰ì„ ê°€ì ¸ì˜´ (ë³µìš© ì—¬ë¶€ëŠ” false)
                const recentDateStr = getMostRecentDate(dateStr);
                if (recentDateStr && appData[recentDateStr]) {
                    state = {
                        water: { goal: appData[recentDateStr].water.goal, current: 0 },
                        supplements: appData[recentDateStr].supplements.map(s => ({...s, taken: false}))
                    };
                } else {
                    // ì™„ì „ ìµœì´ˆ ì ‘ì†ì´ê±°ë‚˜ ê³¼ê±° ê¸°ë¡ì´ í•˜ë‚˜ë„ ì—†ì„ ë•Œ
                    state = { water: { goal: 2000, current: 0 }, supplements: [] };
                }
            }
            
            updateDateUI();
            renderWater();
            renderSupplements();
        }

        // íŠ¹ì • ë‚ ì§œ ì´ì „ì˜ ê°€ì¥ ìµœê·¼ ê¸°ë¡ ë‚ ì§œ ì°¾ê¸°
        function getMostRecentDate(targetDateStr) {
            const dates = Object.keys(appData).filter(d => d < targetDateStr).sort();
            return dates.length > 0 ? dates[dates.length - 1] : null;
        }

        // ìƒíƒœë¥¼ appDataì— ì—…ë°ì´íŠ¸í•˜ê³  localStorageì— ì €ì¥
        function saveData() {
            appData[selectedDate] = JSON.parse(JSON.stringify(state));
            localStorage.setItem('kkobakData', JSON.stringify(appData));
        }

        // ë‚ ì§œ í™”ì‚´í‘œ í´ë¦­ ì‹œ ì´ë™ (+1 ë˜ëŠ” -1)
        function changeDate(offset) {
            const dateObj = new Date(selectedDate);
            dateObj.setDate(dateObj.getDate() + offset);
            selectedDate = getLocalYYYYMMDD(dateObj);
            loadDataForDate(selectedDate);
        }

        // ë„¤ì´í‹°ë¸Œ DatePicker ë‹¬ë ¥ì—ì„œ ë‚ ì§œ ì„ íƒ ì‹œ
        function handleDateSelect(event) {
            if (event.target.value) {
                selectedDate = event.target.value;
                loadDataForDate(selectedDate);
            }
        }

        // ë‚ ì§œ UI ì—…ë°ì´íŠ¸ (í‘œì‹œ í…ìŠ¤íŠ¸ ë…¸ì¶œ)
        function updateDateUI() {
            const dateObj = new Date(selectedDate);
            const options = { month: 'long', day: 'numeric', weekday: 'short' };
            let dateText = dateObj.toLocaleDateString('ko-KR', options);
            
            // YYYY-MM-DD í¬ë§·íŒ… ì°¨ì´ ë°©ì§€ìš© ì •ê·œì‹ ì¹˜í™˜
            dateText = dateText.replace(/ /g, ' '); 

            document.getElementById('currentDateDisplay').textContent = dateText;
            document.getElementById('datePicker').value = selectedDate;
            
            updateReadOnlyState();
        }

        // ì˜¤ëŠ˜ ë‚ ì§œê°€ ì•„ë‹ˆë©´ ì½ê¸° ì „ìš©ìœ¼ë¡œ UI ë³€ê²½
        function updateReadOnlyState() {
            const isToday = (selectedDate === todayStr);
            const btnEditWaterGoal = document.getElementById('btnEditWaterGoal');
            const waterActionButtons = document.getElementById('waterActionButtons');
            const btnAddSupplement = document.getElementById('btnAddSupplement');
            const btnEmptyAddSupplement = document.getElementById('btnEmptyAddSupplement');

            if (isToday) {
                btnEditWaterGoal.classList.remove('hidden');
                waterActionButtons.classList.remove('hidden');
                btnAddSupplement.classList.remove('hidden');
                btnEmptyAddSupplement.classList.remove('hidden');
            } else {
                btnEditWaterGoal.classList.add('hidden');
                waterActionButtons.classList.add('hidden');
                btnAddSupplement.classList.add('hidden');
                btnEmptyAddSupplement.classList.add('hidden');
            }
        }

        // --- Water Logic ---
        function renderWater() {
            document.getElementById('waterCurrentDisplay').textContent = state.water.current;
            document.getElementById('waterGoalDisplay').textContent = state.water.goal;
            
            let percentage = (state.water.current / state.water.goal) * 100;
            const successMsg = document.getElementById('waterSuccessMsg');
            const progressBar = document.getElementById('waterProgressBar');

            if (percentage >= 100) {
                percentage = 100;
                successMsg.classList.remove('hidden');
                progressBar.classList.remove('bg-blue-500');
                progressBar.classList.add('bg-teal-500');
            } else {
                successMsg.classList.add('hidden');
                progressBar.classList.remove('bg-teal-500');
                progressBar.classList.add('bg-blue-500');
            }

            progressBar.style.width = percentage + '%';
        }

        function addWater(amount) {
            if (selectedDate !== todayStr) return; // ì˜¤ëŠ˜ë§Œ ìˆ˜ì • ê°€ëŠ¥
            state.water.current += amount;
            saveData();
            renderWater();
        }

        function openWaterGoalModal() {
            if (selectedDate !== todayStr) return;
            document.getElementById('waterGoalInput').value = state.water.goal;
            openModal('waterGoalModal');
        }

        function saveWaterGoal() {
            if (selectedDate !== todayStr) return;
            const input = parseInt(document.getElementById('waterGoalInput').value);
            if (input && input > 0) {
                state.water.goal = input;
                saveData();
                renderWater();
                closeModal('waterGoalModal');
            }
        }

        function openWaterCustomModal() {
            if (selectedDate !== todayStr) return;
            document.getElementById('waterCustomInput').value = '';
            openModal('waterCustomModal');
        }

        function saveCustomWater() {
            if (selectedDate !== todayStr) return;
            const input = parseInt(document.getElementById('waterCustomInput').value);
            if (input && input > 0) {
                addWater(input);
                closeModal('waterCustomModal');
            }
        }

        // --- Supplement Logic ---
        function renderSupplements() {
            const times = ['morning', 'lunch', 'dinner'];
            const emptyState = document.getElementById('supplementsEmptyState');
            const timeline = document.getElementById('supplementsTimeline');
            const isToday = (selectedDate === todayStr);

            if (state.supplements.length === 0) {
                emptyState.classList.remove('hidden');
                timeline.classList.add('hidden');
                
                // ê³¼ê±° ë‚ ì§œ ë¹ˆ í™”ë©´ ë¬¸êµ¬ ì²˜ë¦¬
                const emptyTitle = emptyState.querySelector('h3');
                const emptyDesc = emptyState.querySelector('p');
                if (isToday) {
                    emptyTitle.textContent = "ì²« ì˜ì–‘ì œë¥¼ ë“±ë¡í•´ë³´ì„¸ìš”!";
                    emptyDesc.innerHTML = "ë§¤ì¼ ì±™ê²¨ ë¨¹ëŠ” ì˜ì–‘ì œë‚˜ ì•½ì„ ë“±ë¡í•˜ë©´<br>ì‹œê°„ëŒ€ë³„ë¡œ ìŠì§€ ì•Šê³  ê´€ë¦¬í•  ìˆ˜ ìˆì–´ìš”.";
                } else {
                    emptyTitle.textContent = "ê¸°ë¡ëœ ì˜ì–‘ì œê°€ ì—†ìŠµë‹ˆë‹¤.";
                    emptyDesc.innerHTML = "ì´ ë‚ ì€ ë“±ë¡ëœ ë³µìš© ê¸°ë¡ì´ ì—†ë„¤ìš”.";
                }
                return;
            } else {
                emptyState.classList.add('hidden');
                timeline.classList.remove('hidden');
            }
            
            times.forEach(time => {
                const listEl = document.getElementById(`list-${time}`);
                listEl.innerHTML = '';
                
                const items = state.supplements.filter(s => s.time === time);
                
                if (items.length === 0) {
                    listEl.innerHTML = `<li class="py-4 text-center text-sm text-slate-400 bg-slate-50/50">ë“±ë¡ëœ ì˜ì–‘ì œê°€ ì—†ìŠµë‹ˆë‹¤.</li>`;
                    return;
                }

                items.forEach(item => {
                    const li = document.createElement('li');
                    li.className = "py-3 px-2 flex items-center justify-between group";
                    
                    const cursorClass = isToday ? 'cursor-pointer' : 'cursor-default';
                    const toggleAction = isToday ? `onclick="toggleSupplement('${item.id}')"` : '';
                    const actionsHTML = isToday ? `
                        <div class="flex items-center gap-2 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity">
                            <button onclick="openSupplementModal('edit', '${item.id}')" class="p-2 text-slate-400 hover:text-blue-500 transition rounded-lg hover:bg-slate-50">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
                            </button>
                            <button onclick="confirmDelete('${item.id}')" class="p-2 text-slate-400 hover:text-red-500 transition rounded-lg hover:bg-slate-50">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                            </button>
                        </div>
                    ` : '';

                    li.innerHTML = `
                        <div class="flex items-center gap-3 flex-1 ${cursorClass}" ${toggleAction}>
                            <div class="w-6 h-6 rounded-full border-2 flex items-center justify-center transition-colors ${item.taken ? 'bg-green-500 border-green-500' : 'border-slate-300'}">
                                ${item.taken ? '<svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>' : ''}
                            </div>
                            <div>
                                <p class="font-medium ${item.taken ? 'text-slate-400 line-through' : 'text-slate-800'}">${item.name}</p>
                                <p class="text-xs ${item.taken ? 'text-slate-300' : 'text-slate-500'}">${item.dosage}</p>
                            </div>
                        </div>
                        ${actionsHTML}
                    `;
                    listEl.appendChild(li);
                });
            });
        }

        function toggleSupplement(id) {
            if (selectedDate !== todayStr) return; // ì˜¤ëŠ˜ë§Œ ìˆ˜ì • ê°€ëŠ¥
            const item = state.supplements.find(s => s.id === id);
            if (item) {
                item.taken = !item.taken;
                saveData();
                renderSupplements();
            }
        }

        function openSupplementModal(mode, id = null) {
            if (selectedDate !== todayStr) return;
            document.getElementById('suppName').value = '';
            document.getElementById('suppDosage').value = '';
            
            if (mode === 'add') {
                document.getElementById('suppModalTitle').textContent = 'ì˜ì–‘ì œ ë“±ë¡';
                document.getElementById('suppId').value = '';
                document.querySelector(`input[name="suppTime"][value="morning"]`).checked = true;
            } else if (mode === 'edit') {
                document.getElementById('suppModalTitle').textContent = 'ì˜ì–‘ì œ ìˆ˜ì •';
                const item = state.supplements.find(s => s.id === id);
                if (item) {
                    document.getElementById('suppId').value = item.id;
                    document.getElementById('suppName').value = item.name;
                    document.getElementById('suppDosage').value = item.dosage;
                    document.querySelector(`input[name="suppTime"][value="${item.time}"]`).checked = true;
                }
            }
            openModal('supplementModal');
        }

        function saveSupplement() {
            if (selectedDate !== todayStr) return; // ì˜¤ëŠ˜ë§Œ ìˆ˜ì • ê°€ëŠ¥
            const id = document.getElementById('suppId').value;
            const name = document.getElementById('suppName').value.trim();
            const dosage = document.getElementById('suppDosage').value.trim();
            const time = document.querySelector('input[name="suppTime"]:checked').value;

            if (!name || !dosage) return;

            if (id) {
                const index = state.supplements.findIndex(s => s.id === id);
                if (index > -1) {
                    state.supplements[index].name = name;
                    state.supplements[index].dosage = dosage;
                    state.supplements[index].time = time;
                }
            } else {
                const newItem = {
                    id: Date.now().toString(),
                    time: time,
                    name: name,
                    dosage: dosage,
                    taken: false
                };
                state.supplements.push(newItem);
            }

            saveData();
            renderSupplements();
            closeModal('supplementModal');
        }

        function confirmDelete(id) {
            if (selectedDate !== todayStr) return; // ì˜¤ëŠ˜ë§Œ ìˆ˜ì • ê°€ëŠ¥
            const btn = document.getElementById('confirmBtn');
            btn.onclick = function() {
                state.supplements = state.supplements.filter(s => s.id !== id);
                saveData();
                renderSupplements();
                closeModal('confirmModal');
            };
            openModal('confirmModal');
        }

        // --- Modal Utility ---
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            const content = modal.querySelector('div');
            
            modal.classList.remove('hidden');
            void modal.offsetWidth; // Trigger reflow
            
            modal.classList.remove('opacity-0');
            content.classList.remove('scale-95');
            content.classList.add('scale-100');
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            const content = modal.querySelector('div');
            
            modal.classList.add('opacity-0');
            content.classList.remove('scale-100');
            content.classList.add('scale-95');
            
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        // ì˜¤ë²„ë ˆì´ í´ë¦­ ì‹œ ëª¨ë‹¬ ë‹«ê¸°
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal(this.id);
                }
            });
        });

        // Start app
        init();
    </script>
</body>
</html>